<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Universums-Simulation (Optimierte Version)</title>

  <!-- 1) PyScript laden (aktuelle Version) -->
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />

  <!-- 2) MathJax für LaTeX-Rendering (optional, aber hier integriert) -->
  <script defer id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <!-- 3) PyScript-Konfiguration: Welche Pakete sollen geladen werden? -->
  <py-config>
    packages = ["numpy", "plotly"]
  </py-config>

  <!-- 4) Grundlegendes CSS für das Layout -->
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    h1, h2 {
      color: #333;
    }
    .equation {
      margin: 15px 0;
      padding: 10px;
      border: 1px solid #ddd;
      background-color: #f9f9f9;
    }
    #plot {
      width: 80%;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <h1>Universums-Simulation (Optimierte Version)</h1>
  <p>
    Diese Anwendung simuliert den Universumszustand 
    \( U(t) \) über 10&nbsp;Milliarden Jahre, basierend auf der Master-Gleichung.
  </p>

  <h2>Master-Gleichung</h2>
  <div class="equation">
    <p>
      \[
        \frac{dU}{dt} \;=\; \Lambda(t) 
                          \;-\; G \cdot \rho_D 
                          \;+\; (k_1 \cdot \eta + k_2 \cdot T) 
                          \;-\; \frac{\rho_I}{L}
      \]
    </p>
    <ul>
      <li>\( U \): Zustand des Universums</li>
      <li>\( \Lambda(t) \): Dunkle Energie (zeitabhängig)</li>
      <li>\( G \): Gravitationskonstante</li>
      <li>\( \rho_D \): Dichte der Dunklen Materie</li>
      <li>\( k_1, k_2 \): Konstanten für Entropie und Temperatur</li>
      <li>\( \eta \): Entropie</li>
      <li>\( T \): Temperatur</li>
      <li>\( \rho_I \): Informationsdichte</li>
      <li>\( L \): Rendering-Kapazität</li>
    </ul>
  </div>

  <!-- Ziel-Container für den Plot -->
  <div id="plot"></div>

  <!-- 5) PyScript: Dein Python-Code mit NumPy und Plotly -->
  <py-script>
    import numpy as np
    import plotly.graph_objects as go
    from js import console

    # (A) Zeitvariable Dunkle Energie (exponentiell abfallend)
    def Lambda(t):
        return 0.01 * np.exp(-0.001 * t)

    # (B) Konstanten
    G = 6.674e-11  # Gravitationskonstante
    rho_D = 0.3    # Dichte der Dunklen Materie
    k1 = 0.005     # Einfluss der Entropie
    k2 = 0.002     # Einfluss der Temperatur
    eta = 1.5      # Entropie
    T = 2.73       # Hintergrundtemperatur (CMB)
    rho_I = 0.05   # Informationsdichte
    L = 1.0        # Rendering-Kapazität

    # (C) Differentialgleichung
    def dU_dt(U, t):
        return Lambda(t) - G * rho_D + (k1 * eta + k2 * T) - (rho_I / L)

    # (D) Zeitachse (0 bis 10 Gyr in "Millionen Jahren" → 10_000)
    t_values = np.linspace(0, 10_000, 500)
    dt = t_values[1] - t_values[0]

    # (E) Numerische Integration (Euler-Methode)
    U_values = np.zeros_like(t_values)
    U_values[0] = 1.0  # Startwert
    for i in range(1, len(t_values)):
        try:
            dU = dU_dt(U_values[i-1], t_values[i-1]) * dt
            U_values[i] = U_values[i-1] + dU
            # Option: Negative Werte abfangen
            if U_values[i] < 0:
                U_values[i] = 0
        except Exception as e:
            console.error(f"Fehler bei t={t_values[i]}: {e}")
            break

    # (F) Plot erstellen
    fig = go.Figure()
    fig.add_trace(
        go.Scatter(
            x=t_values,
            y=U_values,
            mode='lines',
            name='Universumszustand U(t)'
        )
    )
    fig.update_layout(
        title="Simulation des Universumszustands U(t)",
        xaxis_title="Zeit (Millionen Jahre)",
        yaxis_title="Universumszustand U",
        template="plotly_white"
    )

    # (G) Plot anzeigen
    display(fig, target="plot")
  </py-script>

  <!-- HINWEIS:
       - Öffne diese Datei NICHT per Doppelklick (file://), sondern
         über einen Webserver (z.B. python -m http.server) oder
         via GitHub Pages. Sonst blockiert dein Browser externe Skripte.
       - Prüfe bei Fehlern die Entwicklerkonsole (F12).
  -->
</body>
</html>
